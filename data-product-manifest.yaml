version: 0.0.1
discoveryPort:
  name: MAF XConnect Customer Attributes latest
  description: Maf XConnect Customer Attributes
  category: audience
  image: http://google.com
  autofillUserinfo: true
  tags: []
  extra: {}
inputPorts:
  - alias: 'dp_maf_xconnect_customer_central'
    description: 'XConnect Customer Central'
    tags: []
    extra: {}
    syncType: 'pull'
    type: 'dataproduct'
    dataProductUrn: urn:dv:dataproduct:7eef7d1f-4060-4ff9-a9a1-78d9346bfb4c
    projection:
      - id
      - rfm_st_code_name
      - organic
      - fitness
      - sport
      - vegan_prod
      - sh_ncat_code
      - macro_code
      - clc_code
stateManagement:
  alias: 'maf_xconnect_customer_attributes'
  refreshInterval: 00 10 * * *
  updateStrategy: overwrite
  productStoreState:
    logicalSchemaUrn: urn:dv:schema:4b44a747-f0a2-4446-b2aa-dedfc33690be
  retentionVersions: "10"
  updateStrategyOptions:
      uniqueKeyColumns:
        - gcr_id
        - first_name
        - last_name
        - email
        - phone
        - gender_code
        - age_group
        - nationality
      changeTrackColumns:
        - nothing
transformation:
    - alias: "s3_maf_xconnect_customer_attributes_transform"
      description: "step_1"
      type: "SQL"
      query: "SELECT id,concat('{rfm_st_code_name:',rfm_st_code_name,',organic:',organic,',fitness:',fitness,',sport:',sport,',vegan_prod:',vegan_prod,',sh_ncat_code:',sh_ncat_code,',macro_code:',macro_code,',clc_code:',clc_code,'}') FROM customer_central"
      references:
        - alias: 'dp_maf_xconnect_customer_central'
          sqlReference: 'customer_central'
outputPort:
  channels:
    - channelType: REST-API
      queryType: SQL
    - channelType: JDBC
      queryType: SQL
